<!DOCTYPE html>
<html lang="en-us">
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="theme-color" content="dark">
    <title>JavaScript malware | Billal BEGUERADJ</title>

    
    
    
    <meta property="og:site_name" content="Billal BEGUERADJ software, programming, security, startup" />
    <meta property="og:title" content="JavaScript malware | Billal BEGUERADJ"/>
    <meta itemprop="name" content="JavaScript malware | Billal BEGUERADJ" />
    <meta name="twitter:title" content="JavaScript malware | Billal BEGUERADJ" />
    <meta name="application-name" content="JavaScript malware | Billal BEGUERADJ" /><meta name="twitter:card" content="summary"/>

    <meta name="description" content="Billal BEGUERADJ shoftware development, programming, information security, startup" />
    <meta name="twitter:description" content="Billal BEGUERADJ shoftware development, programming, information security, startup"/>
    <meta itemprop="description" content="Billal BEGUERADJ shoftware development, programming, information security, startup"/>
    <meta property="og:description" content="Billal BEGUERADJ shoftware development, programming, information security, startup" />

    

<meta property="og:type" content="article" />
<meta property="article:publisher" content="Billal BEGUERADJ" />
<meta property="og:article:published_time" content=2017-01-24T12:33:21&#43;0800 />
<meta property="article:published_time" content=2017-01-24T12:33:21&#43;0800 />





<script defer type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "JavaScript malware",
    "author": {
      "@type": "Person",
      "name": "Billal BEGUERADJ"
    },
    "datePublished": "2017-01-24",
    "description": "",
    "wordCount":  1352 ,
    "mainEntityOfPage": "True",
    "dateModified": "2017-01-24",
    "publisher": {
      "@type": "Organization",
      "name": "Billal BEGUERADJ",
      "logo": {
        "@type": "imageObject",
        "url": "https:\/\/example.com\/favicon.ico"
      }
    }
  }
</script>



    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    
    <link rel="stylesheet" href="/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css">
    
</head>
    
    <script>
        (function() {
            const colorSchemeKey = 'ThemeColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'ThemeColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.userColorScheme = 'dark';
        } else {
            document.documentElement.dataset.userColorScheme = 'light';
        }
    })();
</script>


    <body class="dark">
        <nav class="navbar">
    <div class="container">
        <div class="flex">
            <div>
                <a class="brand" href="/">
                    
                    
                    Billal BEGUERADJ
                    </a>
            </div>
            <div class="flex">
                
                <a href="/about/">About</a>
                
                <a href="/articles/">Articles</a>
                
                
                    <button id="dark-mode-button">
                    <svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163 0 1 0 1.643 1.641a1.163 1.163 0 0 0-1.643-1.641zm-16.022 14.38a1.74 1.74 0 0 0 0 2.465a1.742 1.742 0 1 0 0-2.465zm13.968-2.147a2.904 2.904 0 0 1-4.108 0a2.902 2.902 0 0 1 0-4.107a2.902 2.902 0 0 1 4.108 0a2.902 2.902 0 0 1 0 4.107z" fill="#FFCC4D"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                    <svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M16 2s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2V2zm18 14s2 0 2 2s-2 2-2 2h-2s-2 0-2-2s2-2 2-2h2zM4 16s2 0 2 2s-2 2-2 2H2s-2 0-2-2s2-2 2-2h2zm5.121-8.707s1.414 1.414 0 2.828s-2.828 0-2.828 0L4.878 8.708s-1.414-1.414 0-2.829c1.415-1.414 2.829 0 2.829 0l1.414 1.414zm21 21s1.414 1.414 0 2.828s-2.828 0-2.828 0l-1.414-1.414s-1.414-1.414 0-2.828s2.828 0 2.828 0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zM16 32s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2v-2z"/><circle fill="#FFD983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                    </button>
                
            </div>
            </div>
    </div>
</nav>

        <main>
            
<div class="container">
    <article>
        <header class="article-header">
            <div class="thumb">
                <div>
                    <h1>JavaScript malware</h1>
                    <div class="post-meta">
                        <div>
                            
                            
                              
                            
                            By Billal BEGUERADJ | <time>January 24, 2017</time>
                            | 7 minutes
                        </div>
                        <div class="tags">
                            
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </article>

    <div class="article-post">
    <p>What are the JavaScript malware attack techniques and how to prevent from them?</p>
<p>Note: I first published this as an answer on InfoSec website under a previous and now deleted profile.</p>
<ol>
<li><strong>Server side polymorphism</strong></li>
</ol>
<p>Literally meaning many shapes, polymorphism is a technique used by malware authors to evade signatures based detectors. Polymorphism is qualified as being server sided when the engine which produces several but different copies of the malware is hosted on a compromised web server <a href="https://pandasecurityus.files.wordpress.com/2008/05/server-side-polymorphism.pdf">(Server-Side Polymorphism:
Crime-Ware as a Service Model (CaaS))</a>. simulated metamorphic encryption generator (SMEG) version 1.0 was the first engine developed to implement the notion of polymorphism for computer viruses on the early 1990&rsquo;s (<a href="http://www.computer.org/csdl/proceedings/snpd/2007/2909/02/290920585.pdf">Parallel analysis of polymorphic viral code using automated deduction system</a>)</p>
<ol start="2">
<li><strong>Code obfuscation</strong></li>
</ol>
<p>The other common feature you may find in malicious JavaScript code is that obfuscation is always used.  This common factor -obfuscation- does not make even things simpler: because innocuous JavaScript code also uses obfuscation (for instance, some developers for example do not want their personal <em>pretty</em> JavaScript function to be understood by others as you can easily read HTML and JS pages codes). Along with server side polymorphism, code obfuscation is a widely used technique by malware authors to circumvent antivirus scanners. A myriad of techniques could be used to obfuscate JavaScript codes such as string reversing, Unicode and base 64 encoding, string splitting and document object model (DOM) interaction (<a href="https://www.sophos.com/en-us/medialibrary/PDFs/technical%20papers/malware_with_your_mocha.pdf?la=en.pdf?dl=true">Malware with your Mocha? Obfuscation and antiÂ­-emulation tricks
in malicious JavaScript.</a>).</p>
<ol start="3">
<li><strong>Code unfolding</strong></li>
</ol>
<p>Code unfolding is the mechanism with which a new code is introduced at run time. In JavaScript, this is made concrete by invoking functions like <code>document.write()</code> and <code>eval()</code> in order to execute obfuscated portions of code and functions. (<a href="http://www.cs.arizona.edu/~debray/Publications/dimva2013.pdf">Weaknesses in Defenses Against Web-Borne Malware</a>)</p>
<ol start="4">
<li><strong>Heap spray</strong></li>
</ol>
<p>This attack targets mainly web browsers. The user controllable data can corrupt the heap by a remote execution code if the miscreant has compromised the user&rsquo;s computer to the point he can have access to this vulnerable memory area (<a href="http://cd80.ca/files/bubble.pdf">BuBBle: A Javascript Engine Level Countermeasure against Heap-Spraying Attacks</a>)</p>
<ol start="5">
<li><strong>Drive-by download</strong></li>
</ol>
<p>Drive-by download attacks consist in downloading and and executing or installing malicious programs without the user&rsquo;s consent. Such attacks occur by exploiting browsers&rsquo; vulnerabilities, their add-ons or plugins such as ActiveX controls or unpatched useful software such as Acrobat Reader and Adobe Flash Player (<a href="http://www.kaspersky.com/images/drive-by_download_attacks_effects_and_detection_methods.pdf">Drive-by download attacjs: effect and detection methods, MSc Information Security</a>)</p>
<ol start="6">
<li><strong>Multi execution paths</strong></li>
</ol>
<p>It is possible to trigger an action only if certain conditions are fulfilled. Such circumstances could be the arrival of a given date or the existence of a file on the system on which the malware is intended to be executed. An other quick and well known example could be a denial of service attack that must be fired only if the number of the botnet&rsquo;s nodes has reached a certain value. That
is the notion of multi execution paths (<a href="https://iseclab.org/papers/explore.pdf">Exploring Multiple Execution Paths for Malware Analysis</a>)</p>
<ol start="7">
<li><strong>Implicit conditionals</strong></li>
</ol>
<p>This technique is mainly used against dynamic approach detectors. The main idea for this process is to execute a set of instructions by hiding the condition that fires it (<a href="http://www.cs.arizona.edu/~debray/Publications/dimva2013.pdf">Weaknesses in Defenses Against Web-Borne. Malware</a>)</p>
<p>Given these common features and tactics used by JaaScript malware, if you want to detect this type of malware as you asked, you need first to study the state of the art of the methods used to detect that. Various methods have been developed so as to detect web (JavaScript) malware. We can divide them into two main categories as follows:</p>
<ol>
<li><strong>Machine learning based classifiers</strong></li>
</ol>
<ul>
<li><strong>Features</strong>:  HTML and JavaScript codes distinguishing features extraction. These features are then evaluated to train a machine learning for classifier generation. The premise of this approach is that malicious webpages are likely to be different from benign ones (Thesis: <a href="http://www.cs.uic.edu/~beshete/pdfs/PhD_Dissertation_Birhanu_ESHETE.pdf">Effective Analysis, Characterization, and Detection of Malicious Web Pages</a>)</li>
<li><strong>Advantages</strong>: Lightweight approach, useful to deal with a bulk of websites analysis.</li>
<li><strong>Drawbacks</strong>: Obsolete against obfuscated JavaScript code and totally useless against new malicious code patters or zero attacks.</li>
</ul>
<ol start="2">
<li><strong>Dynamic methods</strong></li>
</ol>
<ul>
<li><strong>Features</strong>: Based on the dynamic behavior analysis, these techniques are implemented using either proxies where a page is rendered to the visitor only after its safety is checked, or a sandboxing environment relying on honeyclients (Same thesis: <a href="http://www.cs.uic.edu/~beshete/pdfs/PhD_Dissertation_Birhanu_ESHETE.pdf">Effective Analysis, Characterization, and Detection of Malicious Web Pages</a>).</li>
<li><strong>Advantages</strong>: Efficient against zero day attacks and obfuscated code.</li>
<li><strong>Drawbacks</strong>: Resources and time consuming. Sandboxing environments rely on low interaction honeyclients which themselves are based on virus signatures, and thus suffer from the same disadvantages as the static methods&rsquo; ones.</li>
</ul>
<p><strong>What you have tried to do belongs to the first category.</strong></p>
<p>Now, after you are well informed about all this, it can be useful for you to study some available tools dedicated for this purpose in order to implement your own technique. So let me mention you three important tools among so many others:</p>
<ol>
<li><strong>Zozzle</strong></li>
</ol>
<p>Zoozle relies on Bayesian classification  <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">abstract syntax tree</a> (AST) . It is legitimately classified as mostly static web malware detector because it embeds another engine that supervises the JavaScript code execution at run time. Its authors claim that it has a very low false positive rate of 0.0003% and is able to process over one megabyte of HTML and
JavaScript code per second. This tool is intended to be used as a browser plugin; its aim is to protect browsers against heap spray attack. It is time to point out how ZOZZLE operates.</p>
<p>How ZOZZLE operates? The following figure summarizes its core (<a href="http://research-srv.microsoft.com/pubs/152618/usenixsec11b.pdf">ZOZZLE: Fast and Precise In-Browser JavaScript Malware Detection</a>):</p>
<p><a href="http://i.stack.imgur.com/ZX4ow.png"><img loading="lazy" 
    src="http://i.stack.imgur.com/ZX4ow.png" 
    alt="enter image description here" 
     /></a></p>
<ul>
<li>
<p><strong>Extraction and labeling phase:</strong> The classifier needs training data. This data is extracted from obfuscated JavaScript code. Instead of developing an efficient de-obfuscation technique, Compile function interception calls is performed. Compile function is located in <code>jscript.dll</code> library. It is a smart way to obtain plain JavaScript code because it is called each time <code>&lt;SCRIPT&gt;</code> and <code>&lt;IFRAME&gt;</code> tags, or <code>eval()</code> and <code>document.write()</code> functions have been called, which thing defines also the code context. Each code context is saved on the hard drive for further analysis.</p>
</li>
<li>
<p><strong>Feature selection</strong>:  JavaScript AST is used to tag each labeled context code for its safety or malignancy. The features are pre-selected using this formula:
<a href="http://i.stack.imgur.com/1iVd8.png"><img loading="lazy" 
    src="http://i.stack.imgur.com/1iVd8.png" 
    alt="enter image description here" 
     /></a></p>
</li>
</ul>
<p>Where:</p>
<ul>
<li>
<p><strong>A</strong>: malicious context with feature</p>
</li>
<li>
<p><strong>B</strong>: benign context with feature</p>
</li>
<li>
<p><strong>C</strong>: malicious context without feature</p>
</li>
<li>
<p><strong>D</strong>: benign context without feature</p>
</li>
<li>
<p><strong>Classification</strong>: The Bayesian  classifier is used for classification because even if it seems obsolete, in practice it gives good results and it is not time consuming.</p>
</li>
</ul>
<ol start="2">
<li>
<p><strong>Profiler</strong>
Profiler follows the static schema to detect web malware. It combines static features analysis of HTML and JavaScript code, including unified resource locator (URL)s. Then it uses machine learning techniques to teach a classifier that decides if a webpage embeds malicious content or not. Suspicious webpages are not processed by this tool. It rather forwards them to third party
technologies such as Wepawet (<a href="http://www.cs.ucsb.edu/~vigna/publications/2011_canali_cova_kruegel_vigna_Prophiler.pdf">Prophiler: A Fast Filter for the Large-Scale Detection of Malicious Web Pages</a>)</p>
</li>
<li>
<p><strong>SpyProxy</strong></p>
</li>
</ol>
<p>SpyProxy  follows the dynamic analysis principles. It monitors the active content of webpages within a virtual machine before deciding to render them to the visitor or not. The architecture of SpyProxy is illustrated through this figure (<a href="https://www.usenix.org/conference/16th-usenix-security-symposium/spyproxy-execution-based-detection-malicious-web-content">SpyProxy: Execution-based Detection of Malicious Web Content</a>):</p>
<p><a href="http://i.stack.imgur.com/oaUYw.png"><img loading="lazy" 
    src="http://i.stack.imgur.com/oaUYw.png" 
    alt="enter image description here" 
     /></a></p>
<ul>
<li>(<strong>a</strong>): The proxy performs a static analysis over the requested page. In the case it judges is likely to be malicious, if forwards it to the virtual machine. basically only pages with active
content are forwarded to the virtual machine (VM).</li>
<li>(<strong>b</strong>): The virtual machine loads the malicious pages to monitor their activities.</li>
<li>(<strong>c</strong>): Only benign pages are rendered back to the proxy which forwards them in turn to the user&rsquo;s browser.</li>
</ul>
<ol start="4">
<li><strong>Iceshield</strong></li>
</ol>
<p>ICESHIELD performs in-line dynamic code analysis using a set of heuristics to verify attack attempts. Its authors take an inventory of the attacks that usually target the DOM properties of a website that are performed by injecting JavaScript into the website&rsquo;s source code. ICESHIELD supervises the running JavaScript code by predefining a set of rules related to functions calls and
applying heuristics on them in the hope to determinate whether the script is malicious or not (<a href="http://www.ei.ruhr-uni-bochum.de/media/emma/veroeffentlichungen/2011/06/21/iceshield-raid11.pdf">IceShield: Detection and Mitigation of Malicious Websites with a Frozen DOM</a>).</p>

    </div>
</div>

<div class="container">
    
    <nav class="flex container suggested">
        
        <a rel="prev" href="/post/mozilla-sha1/" title="Previous post (older)">
            <span>Previous</span>
            Mozilla beheads SHA-1
            </a>
        
        
        
        <a rel="next" href="/post/opencv-ubuntu16/" title="Next post (newer)">
            <span>Next</span>
            Installing OpenCV 3.2.0 for Python 3.5.2 on Ubuntu 16.04.2 LTS
            </a> 
        
    </nav>
    
</div>
 
<div class="container">
    
    <script src="https://giscus.app/client.js" 
        data-repo="WingLim/hugo-tania"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTYyNjQzMDc="
        
        data-category="Comments"
        data-category-id="DIC_kwDOEtnPc84B_WKP"
        
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        crossorigin="anonymous"
        async
        >
</script>

<script>
    function setGiscusTeheme(theme) {
        let giscus = document.querySelector('.giscus iframe');
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme
                        }
                    }
                },
                'https://giscus.app'
            )
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://giscus.app') return;
        setGiscusTeheme(document.documentElement.dataset.userColorScheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        setGiscusTeheme(e.detail)
    })
</script>

</div>

</main>


        </main>
        <footer class="footer flex">
    <section class="container">
        <nav class="footer-links">
            
            <a href="/index.xml">RSS</a>
            
        </nav>

        
    </section>
    <script defer src="/ts/features.706a523ba43e6d0427c7fdf2b9d05dbd0920d3f12942b453690b495cb2522743.js" 
    data-enable-footnotes="true"
    ></script>
</footer>

    </body>
</html>