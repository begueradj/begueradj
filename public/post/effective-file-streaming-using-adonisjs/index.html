<!DOCTYPE html>
<html lang="en-us">
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="theme-color" content="dark">
    <title>Effective file streaming using AdonisJs | Billal BEGUERADJ</title>

    
    
    
    <meta property="og:site_name" content="Billal BEGUERADJ software, programming, security, startup" />
    <meta property="og:title" content="Effective file streaming using AdonisJs | Billal BEGUERADJ"/>
    <meta itemprop="name" content="Effective file streaming using AdonisJs | Billal BEGUERADJ" />
    <meta name="twitter:title" content="Effective file streaming using AdonisJs | Billal BEGUERADJ" />
    <meta name="application-name" content="Effective file streaming using AdonisJs | Billal BEGUERADJ" /><meta name="twitter:card" content="summary"/>

    <meta name="description" content="Billal BEGUERADJ shoftware development, programming, information security, startup" />
    <meta name="twitter:description" content="Billal BEGUERADJ shoftware development, programming, information security, startup"/>
    <meta itemprop="description" content="Billal BEGUERADJ shoftware development, programming, information security, startup"/>
    <meta property="og:description" content="Billal BEGUERADJ shoftware development, programming, information security, startup" />

    

<meta property="og:type" content="article" />
<meta property="article:publisher" content="Billal BEGUERADJ" />
<meta property="og:article:published_time" content=2019-04-14T12:33:21&#43;0800 />
<meta property="article:published_time" content=2019-04-14T12:33:21&#43;0800 />





<script defer type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Effective file streaming using AdonisJs",
    "author": {
      "@type": "Person",
      "name": "Billal BEGUERADJ"
    },
    "datePublished": "2019-04-14",
    "description": "",
    "wordCount":  1567 ,
    "mainEntityOfPage": "True",
    "dateModified": "2019-04-14",
    "publisher": {
      "@type": "Organization",
      "name": "Billal BEGUERADJ",
      "logo": {
        "@type": "imageObject",
        "url": "https:\/\/example.com\/favicon.ico"
      }
    }
  }
</script>



    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    
    <link rel="stylesheet" href="/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css">
    
</head>
    
    <script>
        (function() {
            const colorSchemeKey = 'ThemeColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'ThemeColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.userColorScheme = 'dark';
        } else {
            document.documentElement.dataset.userColorScheme = 'light';
        }
    })();
</script>


    <body class="dark">
        <nav class="navbar">
    <div class="container">
        <div class="flex">
            <div>
                <a class="brand" href="/">
                    
                    
                    Billal BEGUERADJ
                    </a>
            </div>
            <div class="flex">
                
                <a href="/about/">About</a>
                
                <a href="/articles/">Articles</a>
                
                
                    <button id="dark-mode-button">
                    <svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163 0 1 0 1.643 1.641a1.163 1.163 0 0 0-1.643-1.641zm-16.022 14.38a1.74 1.74 0 0 0 0 2.465a1.742 1.742 0 1 0 0-2.465zm13.968-2.147a2.904 2.904 0 0 1-4.108 0a2.902 2.902 0 0 1 0-4.107a2.902 2.902 0 0 1 4.108 0a2.902 2.902 0 0 1 0 4.107z" fill="#FFCC4D"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                    <svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M16 2s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2V2zm18 14s2 0 2 2s-2 2-2 2h-2s-2 0-2-2s2-2 2-2h2zM4 16s2 0 2 2s-2 2-2 2H2s-2 0-2-2s2-2 2-2h2zm5.121-8.707s1.414 1.414 0 2.828s-2.828 0-2.828 0L4.878 8.708s-1.414-1.414 0-2.829c1.415-1.414 2.829 0 2.829 0l1.414 1.414zm21 21s1.414 1.414 0 2.828s-2.828 0-2.828 0l-1.414-1.414s-1.414-1.414 0-2.828s2.828 0 2.828 0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zM16 32s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2v-2z"/><circle fill="#FFD983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                    </button>
                
            </div>
            </div>
    </div>
</nav>

        <main>
            
<div class="container">
    <article>
        <header class="article-header">
            <div class="thumb">
                <div>
                    <h1>Effective file streaming using AdonisJs</h1>
                    <div class="post-meta">
                        <div>
                            
                            
                              
                            
                            By Billal BEGUERADJ | <time>April 14, 2019</time>
                            | 8 minutes
                        </div>
                        <div class="tags">
                            
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </article>

    <div class="article-post">
    <h3 id="preamble">
    <a href="#preamble" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    Preamble
</h3>
<p>The majority of upload libraries/frameworks process files multiple times when streaming to an external service such as Amazon S3. Their upload workflows are usually designed like so:</p>
<ul>
<li>Process request files then save them to the tmp directory.</li>
<li>Move each file from the tmp directory to the destination directory.</li>
<li>Use the external service’s SDK to finally stream the file to the external service.</li>
</ul>
<p>This process wastes server resources reading/writing single files multiple times.</p>
<p>That is what you can read on the official AdonisJs documentation. Here we learn how to implement that by streaming the files directly to the MySQL database.</p>
<h3 id="our-stack">
    <a href="#our-stack" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    Our stack
</h3>
<ul>
<li>AdonisJs: to build the RESTful API server</li>
<li>Nuxt.js + Vuetify: to design a user interface to interact with our API.</li>
</ul>
<h3 id="our-app">
    <a href="#our-app" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    Our app
</h3>
<p>And this is the simple user interface I want to create:</p>
<p><img loading="lazy" 
    src="/adonisjs-file-streaming.png" 
    alt="file streaming" 
     
    width=882 
    height="406"  /></p>
<p>The left button will be used to upload a file to the RESTful API server. The right button will be used to download it and display it on the right side</p>
<h3 id="project-setup">
    <a href="#project-setup" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    Project setup
</h3>
<p>In my demo, the client and server code are set apart. My client application is handled by Nuxt.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">yarn create nuxt-app client
</span></span></code></pre></td></tr></table>
</div>
</div><p>and the server by AdonisJs:</p>
<pre tabindex="0"><code>adonis new server --api-only
</code></pre><p>On my Github project, I use Vuetify.js and Eslint.</p>
<h3 id="nuxtjs-client-code">
    <a href="#nuxtjs-client-code" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    Nuxt.js client code
</h3>
<p>Here is where the main code is located:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">components/
</span></span><span class="line"><span class="cl">├── PhotoUpload.vue
</span></span><span class="line"><span class="cl">pages/
</span></span><span class="line"><span class="cl">└── index.vue
</span></span><span class="line"><span class="cl">layouts/
</span></span><span class="line"><span class="cl">└── default.vue
</span></span></code></pre></td></tr></table>
</div>
</div><p>In <strong>pages/index.vue</strong>, we will have this code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">photo</span><span class="o">-</span><span class="nx">upload</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">PhotoUpload</span> <span class="nx">from</span> <span class="s1">&#39;@/components/PhotoUpload.vue&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;MainPage&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">PhotoUpload</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The essential part of the code is what the <strong>PhotoUpload.vue</strong> component contains. So I show here the full code and then will explain the main points:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">container</span>
</span></span><span class="line"><span class="cl">    <span class="nx">grid</span><span class="o">-</span><span class="nx">list</span><span class="o">-</span><span class="nx">md</span>
</span></span><span class="line"><span class="cl">    <span class="nx">text</span><span class="o">-</span><span class="nx">xs</span><span class="o">-</span><span class="nx">center</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fill</span><span class="o">-</span><span class="nx">height</span>
</span></span><span class="line"><span class="cl">  <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">layout</span>
</span></span><span class="line"><span class="cl">      <span class="nx">row</span>
</span></span><span class="line"><span class="cl">      <span class="nx">wrap</span>
</span></span><span class="line"><span class="cl">      <span class="nx">align</span><span class="o">-</span><span class="nx">center</span>
</span></span><span class="line"><span class="cl">    <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">flex</span>
</span></span><span class="line"><span class="cl">        <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&#34;url&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">xs12</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sm4</span>
</span></span><span class="line"><span class="cl">      <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">span</span>
</span></span><span class="line"><span class="cl">          <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;font-weight-bold&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">Client</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/span&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">img</span>
</span></span><span class="line"><span class="cl">          <span class="o">:</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;url&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">contain</span>
</span></span><span class="line"><span class="cl">        <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">flex</span>
</span></span><span class="line"><span class="cl">        <span class="nx">xs12</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sm4</span>
</span></span><span class="line"><span class="cl">      <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">text</span><span class="o">-</span><span class="nx">field</span>
</span></span><span class="line"><span class="cl">          <span class="nx">v</span><span class="o">-</span><span class="nx">model</span><span class="o">=</span><span class="s2">&#34;photoName&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;photo&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">outline</span>
</span></span><span class="line"><span class="cl">          <span class="nx">background</span><span class="o">-</span><span class="nx">color</span><span class="o">=</span><span class="s2">&#34;blue&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">color</span><span class="o">=</span><span class="s2">&#34;blue&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">label</span><span class="o">=</span><span class="s2">&#34;Select image&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">append</span><span class="o">-</span><span class="nx">icon</span><span class="o">=</span><span class="s2">&#34;attach_file&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;selectImage&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span>
</span></span><span class="line"><span class="cl">          <span class="nx">ref</span><span class="o">=</span><span class="s2">&#34;image&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;hide-input&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;file&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">accept</span><span class="o">=</span><span class="s2">&#34;image/*&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="err">@</span><span class="nx">change</span><span class="o">=</span><span class="s2">&#34;imageSelected&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">btn</span>
</span></span><span class="line"><span class="cl">          <span class="nx">round</span>
</span></span><span class="line"><span class="cl">          <span class="nx">color</span><span class="o">=</span><span class="s2">&#34;indigo&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;uploadPhoto&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">icon</span>
</span></span><span class="line"><span class="cl">            <span class="nx">color</span><span class="o">=</span><span class="s2">&#34;white&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">cloud_upload</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="err">/v-icon&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/v-btn&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">btn</span>
</span></span><span class="line"><span class="cl">          <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&#34;url&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">color</span><span class="o">=</span><span class="s2">&#34;indigo&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">round</span>
</span></span><span class="line"><span class="cl">          <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;loadPhotoFromServer&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">icon</span>
</span></span><span class="line"><span class="cl">            <span class="nx">color</span><span class="o">=</span><span class="s2">&#34;white&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;download&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">cloud_upload</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="err">/v-icon&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/v-btn&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">flex</span>
</span></span><span class="line"><span class="cl">        <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&#34;url&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">xs12</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sm4</span>
</span></span><span class="line"><span class="cl">      <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">span</span>
</span></span><span class="line"><span class="cl">          <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&#34;photoId&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;font-weight-bold&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">Server</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/span&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">img</span>
</span></span><span class="line"><span class="cl">          <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&#34;photoId&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="o">:</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;`${$axios.defaults.baseURL}/photos/${photoId}`&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">contain</span>
</span></span><span class="line"><span class="cl">        <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-layout&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/v-container&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;PhotoUpload&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">photo</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">photoName</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">photoId</span><span class="o">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">selectImage</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">photo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">click</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">imageSelected</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">photo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">photoName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">photo</span><span class="p">.</span><span class="nx">name</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">photo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">async</span> <span class="nx">uploadPhoto</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">photo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="s1">&#39;multipart/form-data&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="kr">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">$post</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">loadPhotoFromServer</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">photoId</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">&lt;</span><span class="nx">style</span> <span class="nx">scoped</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="p">.</span><span class="nx">hide</span><span class="o">-</span><span class="nx">input</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nx">display</span><span class="o">:</span> <span class="nx">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="o">*</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nx">text</span><span class="o">-</span><span class="nx">transform</span><span class="o">:</span> <span class="nx">none</span> <span class="o">!</span><span class="nx">important</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="p">.</span><span class="nx">download</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nx">transform</span><span class="o">:</span> <span class="nx">rotate</span><span class="p">(</span><span class="mi">180</span><span class="nx">deg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="o">&lt;</span><span class="err">/style&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let us break down this mess. Most the above code was explained in the previous article. We added two small aspects to it though. First, we display the image we choose to send to the server. This image preview functionality in Nuxt.js can be useful in many cases you are enough smart to guess. For that, we draw some place holders in the form of Vuetify components to show it up when it is ready:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">flex</span>
</span></span><span class="line"><span class="cl">  <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&#34;url&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">xs12</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sm4</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">span</span>
</span></span><span class="line"><span class="cl">    <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;font-weight-bold&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="nx">Client</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/span&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">img</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;url&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">contain</span>
</span></span><span class="line"><span class="cl">  <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As we can see, the image will be displayed only if url is loaded <code>v-if=&quot;url&quot;</code>. This famous <code>url</code> is just a variable we declared in the <code>data()</code> method, and we set its content to point to the local photo selected by the user using: <code>URL.createObjectURL(this.photo)</code>.</p>
<p>We also added a Vuetify component to display the photo sent back by the server on a button click:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">flex</span>
</span></span><span class="line"><span class="cl">  <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&#34;photoId&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">xs12</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sm4</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">span</span>
</span></span><span class="line"><span class="cl">    <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;font-weight-bold&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="nx">Server</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/span&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">img</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;${$axios.defaults.baseURL}/photos/${photoId}&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">contain</span>
</span></span><span class="line"><span class="cl">  <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We set photoId to 1 in <code>loadPhotoFromServer()</code> because we are interested to display the file which ID equals to 1 in the MySQL database. We use <code>$axios.defaults.baseURL</code> to refer to the <code>baseURL</code> key we defined in <strong>nuxt.config.js</strong> file to point to the URL on which our AdonisJs API is being served:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">btn</span>
</span></span><span class="line"><span class="cl">  <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&#34;url&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span><span class="o">=</span><span class="s2">&#34;indigo&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">round</span>
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;loadPhotoFromServer&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">icon</span>
</span></span><span class="line"><span class="cl">    <span class="nx">color</span><span class="o">=</span><span class="s2">&#34;white&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;download&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cloud_upload</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/v-icon&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/v-btn&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="adonisjs-rest-api-server-code">
    <a href="#adonisjs-rest-api-server-code" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    AdonisJs REST API server code
</h3>
<p>First of all, we need to create the migration, model and controller files for the photos:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">adonis make:migration photos --action create
</span></span><span class="line"><span class="cl">adonis make:model Photo
</span></span><span class="line"><span class="cl">adonis make:controller Photo --type http
</span></span></code></pre></td></tr></table>
</div>
</div><p>For our demo, let us be YAGNI and define only what we need in the migration file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="s1">&#39;use strict&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/** @type {import(&#39;@adonisjs/lucid/src/Schema&#39;)} */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">use</span><span class="p">(</span><span class="s1">&#39;Schema&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">PhotosSchema</span> <span class="kr">extends</span> <span class="nx">Schema</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">up</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">table</span><span class="p">.</span><span class="nx">increments</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="nx">table</span><span class="p">.</span><span class="nx">specificType</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s2">&#34;longblob&#34;</span><span class="p">).</span><span class="nx">notNullable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="nx">table</span><span class="p">.</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="nx">notNullable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">down</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">drop</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">PhotosSchema</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note that Knex.js which is used by AdonisJs here, does not have a predefined data field for images apart from <code>binary</code>. Luckily this same <strong>Knex.js</strong> offers us the possibility to define a data type of our choice as long as the RDBMS we use supports it using <code>knex.specifiType()</code> method to define the longblob table column.</p>
<p>Since are not interested in using the timestamps fields for our <code>photos</code> table, we should inform the corresponding model <strong>Photo.js</strong> about it:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="s1">&#39;use strict&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/** @type {typeof import(&#39;@adonisjs/lucid/src/Lucid/Model&#39;)} */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">use</span><span class="p">(</span><span class="s1">&#39;Model&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">Photo</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">createdAtColumn</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">updatedAtColumn</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Photo</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The important part now comes from the <strong>PhotoController.js</strong> controller:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="s1">&#39;use strict&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Photo</span> <span class="o">=</span> <span class="nx">use</span><span class="p">(</span><span class="s1">&#39;App/Models/Photo&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// const Database = use(&#39;Database&#39;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getStream</span> <span class="o">=</span> <span class="nx">use</span><span class="p">(</span><span class="s1">&#39;get-stream&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">PhotoController</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">store</span><span class="p">({</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">photo</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">request</span><span class="p">.</span><span class="nx">multipart</span><span class="p">.</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="kr">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">fileContent</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">getStream</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">stream</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nx">photo</span><span class="p">.</span><span class="nx">filecontents</span> <span class="o">=</span> <span class="nx">fileContent</span>
</span></span><span class="line"><span class="cl">      <span class="nx">photo</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">file</span><span class="p">.</span><span class="nx">subtype</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">await</span> <span class="nx">request</span><span class="p">.</span><span class="nx">multipart</span><span class="p">.</span><span class="nx">process</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">photoInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Photo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">photoInstance</span><span class="p">.</span><span class="nx">file</span> <span class="o">=</span> <span class="nx">photo</span><span class="p">.</span><span class="nx">filecontents</span>
</span></span><span class="line"><span class="cl">    <span class="nx">photoInstance</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">photo</span><span class="p">.</span><span class="nx">type</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">await</span> <span class="nx">photoInstance</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">show</span><span class="p">({</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">params</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// const photo = await Database
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">//  .table(&#39;photos&#39;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">//  .select(&#39;file&#39;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">//  .where(&#39;id&#39;, params.id)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">photo</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Photo</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nx">response</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span><span class="p">,</span> <span class="sb">`</span><span class="si">${</span><span class="nx">photo</span><span class="p">.</span><span class="nx">type</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">photo</span><span class="p">.</span><span class="nx">subtype</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nx">response</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">byteLength</span><span class="p">(</span><span class="nx">photo</span><span class="p">.</span><span class="nx">file</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// response.send(photo[0].file)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">photo</span><span class="p">.</span><span class="nx">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">PhotoController</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We used the <code>store()</code> method in the previous article. Here we only add the <code>show()</code> method which receives the photoId we mentioned previously as a paramter in order to use to fetch for the photo in the MySQL database. Of course, as for uploading the photo, we need to define the headers properly to let the client know which type of data it is going to handle.</p>
<p>We can use either the <strong>Database</strong> or the <strong>Query Builder</strong> providers to look for the photo in the database. Our code comments out the previous option so that we can use each one we prefer.</p>
<p>If you upload a photo, you will find it on the server, precisely in the folder <strong>/tmp/photos</strong>. Note that you have to enable CORS for the requests to be acceped. You can do that by setting cors: true in <strong>config/cors.js</strong> file. For larger images, set the limit value of maxSize to whatever you want in <strong>/config/bodyParser.js</strong> which is 20mb by default.</p>
<p>Note that we forgot to mention one important thing. Actually it is the first thing to set in the API because without it/them we can not communicate with the server: the routes. So in <strong>start/routes.js</strong>, we can define the routes to our photos resources as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">Route</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>That is it. I made a <a href="https://github.com/begueradj/adonisjs-stream-file-to-db">GitHub repository</a> for this demo if anyone wants to try it or make a pull request to improve it.</p>

    </div>
</div>

<div class="container">
    
    <nav class="flex container suggested">
        
        <a rel="prev" href="/post/adonisjs-nuxtjs-axios-file-upload/" title="Previous post (older)">
            <span>Previous</span>
            File upload from a Nuxt.js client to an AdonisJS RESTful API server using axios
            </a>
        
        
        
        <a rel="next" href="/post/how-to-use-moment.js-with-adonisjs/" title="Next post (newer)">
            <span>Next</span>
            How to use Moment.js with AdonisJs
            </a> 
        
    </nav>
    
</div>
 
<div class="container">
    
    <script src="https://giscus.app/client.js" 
        data-repo="WingLim/hugo-tania"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTYyNjQzMDc="
        
        data-category="Comments"
        data-category-id="DIC_kwDOEtnPc84B_WKP"
        
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        crossorigin="anonymous"
        async
        >
</script>

<script>
    function setGiscusTeheme(theme) {
        let giscus = document.querySelector('.giscus iframe');
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme
                        }
                    }
                },
                'https://giscus.app'
            )
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://giscus.app') return;
        setGiscusTeheme(document.documentElement.dataset.userColorScheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        setGiscusTeheme(e.detail)
    })
</script>

</div>

</main>


        </main>
        <footer class="footer flex">
    <section class="container">
        <nav class="footer-links">
            
            <a href="/index.xml">RSS</a>
            
        </nav>

        
    </section>
    <script defer src="/ts/features.706a523ba43e6d0427c7fdf2b9d05dbd0920d3f12942b453690b495cb2522743.js" 
    data-enable-footnotes="true"
    ></script>
</footer>

    </body>
</html>